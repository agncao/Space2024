!function(i){"function"==typeof define&&define.amd?define(i):i()}((function(){"use strict";const i=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:t.color})})},t=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.PolylineDashType,{color:t.color,gapColor:t.gapColor,dashLength:t.dashLength,dashPattern:t.dashPattern})})},e=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.PolylineArrowType,{color:t.color})})},s=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.PolylineGlowType,{color:t.color,glowPower:t.glowPower,taperPower:t.taperPower})})},r=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.PolylineOutlineType,{color:t.color,outlineWidth:t.outlineWidth,outlineColor:t.outlineColor})})},o=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.FadeType,{repeat:t.repeat,fadeInColor:t.fadeInColor,fadeOutColor:t.fadeOutColor,time:t.time,maximumDistance:t.maximumDistance,fadeDirection:t.fadeDirection})})},n=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.ImageType,{image:t.image,repeat:t.repeat})})},l=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({translucent:!0});i._primitives[0].appearance.material=new Cesium.Material({fabric:{uniforms:{image:t.image,color:t.color,speed:t.speed,count:t.count,direction:t.direction,order:t.order},source:"czm_material czm_getMaterial(czm_materialInput materialInput)\n          {\n              czm_material material = czm_getDefaultMaterial(materialInput);\n                  vec2 st = materialInput.st;\n                  float time = fract( czm_frameNumber  *  speed / 1000.0);\n                 vec4 colorImage = texture2D(image, vec2(fract(count*st.s - time), st.t));\n                  material.alpha = colorImage.a * color.a;\n                  material.diffuse = (colorImage.rgb+color.rgb)/2.0;\n                  return material;\n          }"}})},h=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({translucent:!0});i._primitives[0].appearance.material=new Cesium.Material({fabric:{uniforms:{color:t.color,speed:t.speed,percent:t.percent,opacity:t.opacity},source:"\n          uniform vec4 color;\n          uniform float speed;\n          uniform float percent;\n          uniform float opacity;\n          czm_material czm_getMaterial(czm_materialInput materialInput)\n              {\n                  czm_material material = czm_getDefaultMaterial(materialInput);\n                  vec2 st = materialInput.st;\n                  float time = fract( czm_frameNumber  *  speed / 1000.0);\n                  time *= (1.0 + percent);\n                  float alpha = smoothstep(time- percent, time, st.s) * step(-time, -st.s);\n                  alpha += opacity;\n                  material.diffuse= color.rgb;\n                  material.alpha = alpha;\n                  return material;\n              }\n              "}})},a=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({translucent:!0});i._primitives[0].appearance.material=new Cesium.Material({fabric:{uniforms:{color:t.color,speed:t.speed},source:"uniform vec4 color;\n      uniform float speed;\n      czm_material czm_getMaterial(czm_materialInput materialInput)\n      {\n          czm_material material = czm_getDefaultMaterial(materialInput);\n          float time = fract( czm_frameNumber  *  speed / 1000.0);\n          vec2 st = materialInput.st;\n          float scalar = smoothstep(0.0,1.0,time);\n          material.diffuse = color.rgb * scalar;\n          material.alpha = color.a * scalar ;\n          return material;\n      }"}})},_=(i,t)=>{i._primitives[0].appearance=new Cesium.PolylineMaterialAppearance({translucent:!0});i._primitives[0].appearance.material=new Cesium.Material({fabric:{uniforms:{color:t.color,speed:t.speed},source:"\n          uniform vec4 color;\n          uniform float speed;\n\n          czm_material czm_getMaterial(czm_materialInput materialInput){\n            czm_material material = czm_getDefaultMaterial(materialInput);\n            vec2 st = materialInput.st;\n            float time = fract(czm_frameNumber * speed / 1000.0);\n            material.diffuse = color.rgb;\n            material.alpha = color.a * fract(st.s-time);\n            return material;\n          }\n          "}})},p=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.WaterType,{baseWaterColor:t.baseWaterColor,blendColor:t.blendColor,normalMap:t.normalMap,frequency:t.frequency,animationSpeed:t.animationSpeed,amplitude:t.amplitude})})},d=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.DotType,{lightColor:t.lightColor,darkColor:t.darkColor,repeat:t.repeat})})},c=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.CheckerboardType,{lightColor:t.lightColor,darkColor:t.darkColor,repeat:t.repeat})})},u=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.StripeType,{horizontal:t.horizontal,evenColor:t.evenColor,oddColor:t.oddColor,offset:t.offset,repeat:t.repeat})})},m=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.GridType,{color:t.color,cellAlpha:t.cellAlpha,lineCount:new Cesium.Cartesian2(t.lineCount.x,t.lineCount.y),lineThickness:new Cesium.Cartesian2(t.lineThickness.x,t.lineThickness.y)})})},v=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.ImageType,{image:t.image,repeat:t.repeat})})},C=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.FadeType,{fadeInColor:t.fadeInColor,fadeOutColor:t.fadeOutColor,maximumDistance:t.maximumDistance,repeat:t.repeat,fadeDirection:t.fadeDirection,time:t.time})})},g=(i,t)=>{i._primitives[0].appearance=new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:t.color})})};class f{static build(i){let t=i.flat(1/0);return Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2])}}const w=100,y=Math.PI/2,P=1e-4,b=(i,t)=>Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)),W=i=>{let t=0;return i&&Array.isArray(i)&&i.length>0&&i.forEach(((e,s)=>{s<i.length-1&&(t+=b(e,i[s+1]))})),t},M=i=>Math.pow(W(i),.99),S=(i,t)=>{let e,s=Math.asin(Math.abs(t[1]-i[1])/b(i,t));return t[1]>=i[1]&&t[0]>=i[0]?e=s+Math.PI:t[1]>=i[1]&&t[0]<i[0]?e=2*Math.PI-s:t[1]<i[1]&&t[0]<i[0]?e=s:t[1]<i[1]&&t[0]>=i[0]&&(e=Math.PI-s),e},D=(i,t,e,s,r)=>{let o=S(i,t),n=r?o+e:o-e,l=s*Math.cos(n),h=s*Math.sin(n);return[t[0]+l,t[1]+h]},A=(i,t,e)=>{let s=S(t,i)-S(t,e);return s<0?s+2*Math.PI:s},k=(i,t,e)=>(e[1]-i[1])*(t[0]-i[0])>(t[1]-i[1])*(e[0]-i[0]),E=(i,t)=>[(i[0]+t[0])/2,(i[1]+t[1])/2],T=(i,t,e)=>{let s=[(i[0]+t[0])/2,(i[1]+t[1])/2],r=[s[0]-i[1]+t[1],s[1]+i[0]-t[0]],o=[(i[0]+e[0])/2,(i[1]+e[1])/2],n=[o[0]-i[1]+e[1],o[1]+i[0]-e[0]];return I(s,r,o,n)},I=(i,t,e,s)=>{if(i[1]===t[1]){return[(s[0]-e[0])/(s[1]-e[1])*(i[1]-e[1])+e[0],i[1]]}if(e[1]===s[1]){return[(t[0]-i[0])/(t[1]-i[1])*(e[1]-i[1])+i[0],e[1]]}let r=(t[0]-i[0])/(t[1]-i[1]),o=(s[0]-e[0])/(s[1]-e[1]),n=(r*i[1]-i[0]-o*e[1]+e[0])/(r-o);return[r*n-r*i[1]+i[0],n]},F=i=>{if(i.length<=2)return i;{let[t,e]=[2,[]],s=i.length-t-1;e.push(i[0]);for(let r=0;r<=s;r++)for(let s=0;s<=1;s+=.05){let[o,n]=[0,0];for(let e=0;e<=t;e++){let t=x(e,s);o+=t*i[r+e][0],n+=t*i[r+e][1]}e.push([o,n])}return e.push(i[i.length-1]),e}},x=(i,t)=>{let e=0;return 0===i?e=Math.pow(t-1,2)/2:1===i?e=(-2*Math.pow(t,2)+2*t+1)/2:2===i&&(e=Math.pow(t,2)/2),e},$=(i,t)=>{let e=((i,t)=>{let[e,s,r,o,n]=[i[0],i[1],i[2],null,null],l=R(0,e,s,r)[0],h=U(e,s,r);if(Math.sqrt(h[0]*h[0]+h[1]*h[1])>P){let i=E(e,s),t=e[0]-i[0],r=e[1]-i[1],h=2/b(e,s),a=-h*r,_=h*t,p=a*a-_*_,d=2*a*_,c=_*_-a*a,u=l[0]-i[0],m=l[1]-i[1];o=i[0]+p*u+d*m,n=i[1]+d*u+c*m}else o=e[0]+t*(s[0]-e[0]),n=e[1]+t*(s[1]-e[1]);return[o,n]})(t,i),[s,r,o,n,l]=[null,null,null,[e],[]];for(let e=0;e<t.length-2;e++){[s,r,o]=[t[e],t[e+1],t[e+2]];let l=R(i,s,r,o);n=n.concat(l)}let h=((i,t)=>{let e=i.length,s=i[e-3],r=i[e-2],o=i[e-1],n=R(0,s,r,o)[1],l=U(s,r,o),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]),[a,_]=[null,null];if(h>P){let i=E(r,o),t=o[0]-i[0],e=o[1]-i[1],s=2/b(r,o),l=-s*e,h=s*t,p=l*l-h*h,d=2*l*h,c=h*h-l*l,u=n[0]-i[0],m=n[1]-i[1];a=i[0]+p*u+d*m,_=i[1]+d*u+c*m}else a=o[0]+t*(r[0]-o[0]),_=o[1]+t*(r[1]-o[1]);return[a,_]})(t,i);h&&n.push(h);for(let i=0;i<t.length-1;i++){s=t[i],r=t[i+1],l.push(s);for(let t=0;t<w;t++){let e=j(t/w,s,n[2*i],n[2*i+1],r);l.push(e)}l.push(r)}return l},L=function(i){if(i.length<=2)return i;{let t=[],e=i.length-1;for(let s=0;s<=1;s+=.01){let[r,o]=[0,0];for(let t=0;t<=e;t++){let n=H(e,t),l=Math.pow(s,t),h=Math.pow(1-s,e-t);r+=n*l*h*i[t][0],o+=n*l*h*i[t][1]}t.push([r,o])}return t.push(i[e]),t}},G=i=>{let t=1;switch(i){case i<=1:t=1;break;case 2===i:t=2;break;case 3===i:t=6;break;case 24===i:t=24;break;case 5===i:t=120;break;default:for(let e=1;e<=i;e++)t*=e}return t},H=(i,t)=>G(i)/(G(t)*G(i-t)),O=(i,t,e,s)=>{let[r,o,n,l]=[null,null,[],s-e];l=l<0?l+2*Math.PI:l;for(let s=0;s<=100;s++){let h=e+l*s/100;r=i[0]+t*Math.cos(h),o=i[1]+t*Math.sin(h),n.push([r,o])}return n},R=(i,t,e,s)=>{let r=U(t,e,s),[o,n,l,h,a]=[null,null,null,null,null],_=Math.sqrt(r[0]*r[0]+r[1]*r[1]),p=r[0]/_,d=r[1]/_,c=b(t,e),u=b(e,s);return _>P?k(t,e,s)?(l=i*c,h=e[0]-l*d,a=e[1]+l*p,o=[h,a],l=i*u,h=e[0]+l*d,a=e[1]-l*p,n=[h,a]):(l=i*c,h=e[0]+l*d,a=e[1]-l*p,o=[h,a],l=i*u,h=e[0]-l*d,a=e[1]+l*p,n=[h,a]):(h=e[0]+i*(t[0]-e[0]),a=e[1]+i*(t[1]-e[1]),o=[h,a],h=e[0]+i*(s[0]-e[0]),a=e[1]+i*(s[1]-e[1]),n=[h,a]),[o,n]},U=(i,t,e)=>{let s=i[0]-t[0],r=i[1]-t[1],o=Math.sqrt(s*s+r*r);s/=o,r/=o;let n=e[0]-t[0],l=e[1]-t[1],h=Math.sqrt(n*n+l*l);return n/=h,l/=h,[s+n,r+l]},j=(i,t,e,s,r)=>{i=Math.max(Math.min(i,1),0);let[o,n]=[1-i,i*i],l=n*i,h=o*o,a=h*o;return[a*t[0]+3*h*i*e[0]+3*o*n*s[0]+l*r[0],a*t[1]+3*h*i*e[1]+3*o*n*s[1]+l*r[1]]},z=i=>{var t=viewer.scene.globe.ellipsoid.cartesianToCartographic(i),e=Cesium.Math.toDegrees(t.latitude);return[Cesium.Math.toDegrees(t.longitude),e]},B=i=>{var t=viewer.scene.globe.ellipsoid.cartesianToCartographic(i),e=Cesium.Math.toDegrees(t.latitude);return[Cesium.Math.toDegrees(t.longitude),e,t.height]};function q(i){for(var t,e,s,r=[],o=0;o<i.length;o++){var n=(t=i[o],e=void 0,s=void 0,e=t[0]/20037508.34*180,s=t[1]/20037508.34*180,[e,180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2)]);r.push(...n)}return r}function N(i){return function(i){var t=6378137,e=i[0]*Math.PI/180*t,s=i[1]*Math.PI/180;return[e,3189068.5*Math.log((1+Math.sin(s))/(1-Math.sin(s)))]}(z(i))}function K(){var i=URL.createObjectURL(new Blob),t=i.toString();return URL.revokeObjectURL(i),t.substr(t.lastIndexOf("/")+1)}class Y{constructor(){this._name=""}setName(i){this._name=i}}class X extends Y{constructor(i,t){super(),this._viewer=i,this._coordinates=t,this._primitives=[],this._entities=[],this._billboards=[],this._style=null,this._builder=null}}class J{constructor(){return J.instance||(J.instance=this,this._points=viewer.scene.primitives.add(new Cesium.BillboardCollection)),J.instance}static getInstance(){return this.instance?this.instance:this.instance=new J}}const V={pixelOffsetX:0,pixelOffsetY:0,eyeOffsetX:0,eyeOffsetY:0,horizontalOrigin:"CENTER",verticalOrigin:"CENTER",scale:1,image:"./images/x.png",color:"#ffffff",rotation:0};class Q extends X{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=f,this._id=t||K(),this._style=s||V;let r=this._builder.build(e);this._billboard=J.getInstance()._points.add({position:r,color:Cesium.Color.fromCssColorString(this._style.color),id:`point:${this._id}`,image:this._style.image,rotation:this._style.rotation,pixelOffset:new Cesium.Cartesian2(this._style.pixelOffsetX,this._style.pixelOffsetY)}),this._type="Point",this._billboard._distanceDisplayCondition=new Cesium.DistanceDisplayCondition(1e5),this._billboards.push(this._billboard),this._coordinates=e,console.log(this._billboard),this._model=null}setModel(i,t,e,s,r){this._model&&this._viewer.scene.primitives.remove(this._model),this._model=function(i,t,e,s,r,o){var n=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t,e,s));return i.scene.primitives.add(Cesium.Model.fromGltf({url:r,modelMatrix:n,scale:o}))}(this._viewer,i,t,e,s,r),this._model._distanceDisplayCondition=new Cesium.DistanceDisplayCondition(0,1e5)}setModelDistanceDisplayCondition(i,t){this._model._distanceDisplayCondition=new Cesium.DistanceDisplayCondition(i,t)}show(i){this._billboard.show=i}move(i){console.log("我正在move");for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}let t=this._builder.build(this._coordinates);for(const i of this._billboards)i.position=t;return t}update(i,t){2===this._coordinates[i].length?this._coordinates[i]=z(t):3===this._coordinates[i].length&&(this._coordinates[i]=B(t));let e=this._builder.build(this._coordinates);for(const i of this._billboards)i.position=e;return e}dispose(){for(const i of this._billboards)J.getInstance()._points.remove(i)}highlight(i,t){let e=this._builder.build(this._coordinates);return J.getInstance()._points.add({position:e,color:Cesium.Color.fromCssColorString(this._style.color),id:`point:${this._id}`,image:this._style.image,rotation:this._style.rotation,scale:1.5,pixelOffset:new Cesium.Cartesian2(this._style.pixelOffsetX,this._style.pixelOffsetY)})}}const Z=(i,t,e,s,r,o)=>{r&&t[0]!==t[t.length-1]&&t.push(t[0]);var n=((i,t)=>i.length<2?null:new Cesium.PolylineGeometry({positions:i,width:t}))(t,s=null==s?1:s);if(null!=n)return new Cesium.Primitive({allowPicking:o,releaseGeometryInstances:!1,geometryInstances:new Cesium.GeometryInstance({geometry:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(e)},id:i}),appearance:new Cesium.PolylineMaterialAppearance({material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:Cesium.Color.RED})}),asynchronous:!1})};class ii extends Y{constructor(i,t){super(),this._viewer=i,this._coordinates=t,this._primitives=[],this._style=null,this._builder=null}show(i){for(const t of this._primitives)t.show=i}move(i){var p=Object.assign({},this._primitives[0].appearance.material.uniforms),d=this._style.lineStyle;for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let c=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),u=this._style.width,m=this._builder.build(this._coordinates),v=this._viewer.scene.primitives.add(Z(`border:${this._id}`,m,c,u,!1,!0));switch(this._primitives.push(v),d){case"Dash":t(this,p);break;case"Glow":s(this,p);break;case"Arrow":e(this,p);break;case"Outline":r(this,p);break;case"Fade":o(this,p);break;case"Image":n(this,p);break;case"Pulse":l(this,p);break;case"Flow":h(this,p);break;case"Twinkle":a(this,p);break;case"Scan":_(this,p)}return m}update(i,p){var d=Object.assign({},this._primitives[0].appearance.material.uniforms),c=this._style.lineStyle;2===this._coordinates[i].length?this._coordinates[i]=z(p):3===this._coordinates[i].length&&(this._coordinates[i]=B(p));for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let u=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),m=this._style.width,v=this._builder.build(this._coordinates),C=this._viewer.scene.primitives.add(Z(`border:${this._id}`,v,u,m,!1,!0));switch(this._primitives.push(C),c){case"Dash":t(this,d);break;case"Glow":s(this,d);break;case"Arrow":e(this,d);break;case"Outline":r(this,d);break;case"Fade":o(this,d);break;case"Image":n(this,d);break;case"Pulse":l(this,d);break;case"Flow":h(this,d);break;case"Twinkle":a(this,d);break;case"Scan":_(this,d)}return v}dispose(){for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[]}}class ti{static build(i){let t=i.flat(1/0);return Cesium.Cartesian3.fromDegreesArrayHeights(t)}}const ei={color:"#FF0000",opacity:1,width:1,materialType:"Color",clampToGround:!1,rotationDegree:0,closure:!1,lineStyle:"Solid",lineStyleParams:{color:{red:1,green:0,blue:0,alpha:1}}};class si extends ii{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=ti,this._id=t||K(),this._style=s||Object.assign({},ei);let r=this._builder.build(e),o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),n=this._style.width,l=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,o,n,!1,!0));this._primitives.push(l),this._type="Line",this._coordinates=e}new(i,t,e){return new si(this._viewer,i,t,e)}highlight(i,t){let e=this._builder.build(this._coordinates),s=this._style.width+3;return Z(`${i}:${this._id}`,e,t,s,!1,!0)}}class ri{static build(i){let t=i.flat(1/0);return Cesium.Cartesian3.fromDegreesArrayHeights(t)}}class oi extends ii{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=ri,this._id=t||K(),this._style=s||Object.assign({},ei);let r=this._builder.build(e);console.log(this._style.color),console.log(this._style.opacity);let o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),n=this._style.width,l=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,o,n,!1,!0));this._primitives.push(l),this._type="Polyline",this._coordinates=e}new(i,t,e){return new oi(this._viewer,i,t,e)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}const ni=(i,t,e,s,r)=>{e=null==e?Cesium.Color.RED:e;var o=((i,t)=>i.length<2?null:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(i),extrudedHeight:t}))(t,r);if(null!=o){var n=s?e.withAlpha(s):e;return new Cesium.Primitive({releaseGeometryInstances:!1,geometryInstances:new Cesium.GeometryInstance({geometry:o,attributes:{color:new Cesium.ColorGeometryInstanceAttribute.fromColor(n)},id:i}),appearance:new Cesium.EllipsoidSurfaceAppearance({material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:n})}),asynchronous:!1})}},li=(i,t,e,s)=>{s=null==s?Cesium.Color.RED:s;var r=(i=>i.length<2?null:new Cesium.PolygonOutlineGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(i)}))(e);if(null!=r)return new Cesium.Primitive({releaseGeometryInstances:!1,geometryInstances:new Cesium.GeometryInstance({geometry:r,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(s)},id:t}),appearance:new Cesium.PerInstanceColorAppearance({flat:!0,translucent:!1,renderState:{lineWidth:Math.min(4,i.scene.maximumAliasedLineWidth)}}),asynchronous:!1})};class hi extends Y{constructor(i,t){super(),this._viewer=i,this._coordinates=t,this._primitives=[],this._style=null,this._builder=null}show(i){for(const t of this._primitives)t.show=i}move(i){var t=Object.assign({},this._primitives[0].appearance.material.uniforms),e=this._style.fillStyle,s=this._primitives[0].geometryInstances.geometry._height;for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let r=this._builder.build(this._coordinates),o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let n=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,r,o,this._style.opacity,s)),l=Cesium.Color.fromCssColorString(this._style.outlineColor),h=this._style.outlineWidth;this._style.outline||(h=0);let a=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,l,h,!1,!0));switch(this._primitives.push(n),this._primitives.push(a),e){case"Solid":g(this,t);break;case"Fade":C(this,t);break;case"Image":v(this,t);break;case"Grid":m(this,t);break;case"Stripe":u(this,t);break;case"Checkerboard":c(this,t);break;case"Dot":d(this,t);break;case"Water":p(this,t)}return r}update(i,t){var e=Object.assign({},this._primitives[0].appearance.material.uniforms),s=this._style.fillStyle,r=this._primitives[0].geometryInstances.geometry._height;2===this._coordinates[i].length?this._coordinates[i]=z(t):3===this._coordinates[i].length&&(this._coordinates[i]=B(t));for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let o=this._builder.build(this._coordinates),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));switch(this._primitives.push(l),this._primitives.push(_),s){case"Solid":g(this,e);break;case"Fade":C(this,e);break;case"Image":v(this,e);break;case"Grid":m(this,e);break;case"Stripe":u(this,e);break;case"Checkerboard":c(this,e);break;case"Dot":d(this,e);break;case"Water":p(this,e)}return o}dispose(){for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[]}}class ai{static build(i){let t=i.flat(1/0);return Cesium.Cartesian3.fromDegreesArrayHeights(t)}}const _i={color:"#FF0000",opacity:.5,outline:!0,outlineWidth:1,outlineColor:"#FF0000",clampToGround:!1,rotationDegree:0,clampToGround:!1,fill:!0,fillStyle:"Solid",fillStyleParams:{color:{red:1,green:0,blue:0,alpha:.5}}};class pi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=ai,this._id=t||K(),this._style=s||Object.assign({},_i);let o=ai.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="Polygon",this._coordinates=e}new(i,t,e,s){return new pi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class di{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]]));var e=q(function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[e[0],s[1]],s,[s[0],e[1]],e]}return t}(t));return Cesium.Cartesian3.fromDegreesArray(e)}}class ci extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=di,this._id=t||K();let o=this._builder.build(e);this._style=s||Object.assign({},_i);let n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="Rectangle",this._coordinates=e}new(i,t,e,s){return new ci(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class ui{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),e=t[0];var s=function(i,t){let[e,s,r,o]=[null,null,null,[]];for(let n=0;n<=100;n++)r=2*Math.PI*n/100,e=i[0]+t*Math.cos(r),s=i[1]+t*Math.sin(r),o.push([e,s]);return o}(e,b(e,t[1])),r=q(s);return Cesium.Cartesian3.fromDegreesArray(r)}}class mi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=ui,this._id=t||K(),this._style=s||Object.assign({},_i);let o=ui.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=window.viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=window.viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="Circle",this._coordinates=e}new(i,t,e,s){return new mi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class vi{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1]])),[e,s,r,o,n]=[t[0],t[1],t[2],null,null],l=T(e,s,r),h=b(e,l),a=S(e,l),_=S(s,l);k(e,s,r)?(o=_,n=a):(o=a,n=_);let p=q(O(l,h,o,n));return Cesium.Cartesian3.fromDegreesArray(p)}}class Ci extends ii{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=vi,this._id=t||K(),this._style=s||Object.assign({},ei);let r=this._builder.build(e),o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),n=this._style.width,l=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,o,n,!1,!0));this._primitives.push(l),this._type="Arc",this._coordinates=e}new(i,t,e){return new Ci(this._viewer,i,t,e)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class gi{static build(i){if(3===i[0].length)for(const t of i)t.pop();let t=i.flat(1/0),e=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray(t)),s=q($(.3,e));return Cesium.Cartesian3.fromDegreesArray(s)}}class fi extends ii{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=gi,this._id=t||K(),this._style=s||Object.assign({},ei),console.log(ei);let r=gi.build(e),o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),n=this._style.width,l=window.viewer.scene.primitives.add(Z(`border:${this._id}`,r,o,n,!1,!0));this._primitives.push(l),this._type="Curve",this._coordinates=e}new(i,t,e){return new fi(this._viewer,i,t,e)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class wi{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1]])),[e,s,r,o,n]=[t[0],t[1],t[2],void 0,void 0],l=T(e,s,r),h=b(e,l),a=S(e,l),_=S(s,l);k(e,s,r)?(o=_,n=a):(o=a,n=_),t=O(l,h,o,n),t.push(t[0]);var p=q(t);return Cesium.Cartesian3.fromDegreesArray(p)}}class yi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=wi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=window.viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=window.viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="Arch",this._coordinates=e}new(i,t,e,s){return new yi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Pi{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),[e,s]=[t[0],t[1]],r=function(i,t,e){let[s,r,o,n]=[null,null,null,[]];for(let l=0;l<=w;l++)o=2*Math.PI*l/w,s=i[0]+t*Math.cos(o),r=i[1]+e*Math.sin(o),n.push([s,r]);return n}(E(e,s),Math.abs((e[0]-s[0])/2),Math.abs((e[1]-s[1])/2));var o=q(r);return Cesium.Cartesian3.fromDegreesArray(o)}}class bi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Pi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="Ellipse",this._coordinates=e}new(i,t,e,s){return new bi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Wi{static build(i){const t=3e6;let e=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),[s,r]=[e[0],e[1]],o=b(s,r)/5;o=o>t?t:o;var n=q([s,r,D(s,r,Math.PI/6,o,!1),r,D(s,r,Math.PI/6,o,!0)]);return Cesium.Cartesian3.fromDegreesArray(n)}}class Mi extends ii{constructor(i,t,e,s){super(i,e),this._viewer=i,this._builder=Wi,this._id=t||K(),this._style=s||Object.assign({},ei);let r=this._builder.build(e),o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity),n=this._style.width,l=window.viewer.scene.primitives.add(Z(`border:${this._id}`,r,o,n,!1,!0));this._primitives.push(l),this._type="StraightThinArrow",this._coordinates=e}new(i,t,e){return new Mi(this._viewer,i,t,e)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Si{static build(i){const t=Math.PI/8.5,e=Math.PI/13;let s=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),[r,o]=[s[0],s[1]],n=M(s),l=.1*n,h=.2*n,a=.25*n,_=D(o,r,y,l,!0),p=D(o,r,y,l,!1),d=D(r,o,t,a,!1),c=D(r,o,t,a,!0);var u=q([_,D(r,o,e,h,!1),d,o,c,D(r,o,e,h,!0),p]);return Cesium.Cartesian3.fromDegreesArray(u)}}class Di extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Si,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="FatPointedArrow",this._coordinates=e}new(i,t,e,s){return new Di(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Ai{static build(i){const t=Math.PI/4,e=.17741*Math.PI;let s=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),[r,o]=[s[0],s[1]],n=M(s),l=.05*n,h=.1*n,a=.15*n,_=D(o,r,y,l,!0),p=D(o,r,y,l,!1),d=D(r,o,t,a,!1),c=D(r,o,t,a,!0);var u=q([_,D(r,o,e,h,!1),d,o,c,D(r,o,e,h,!0),p]);return Cesium.Cartesian3.fromDegreesArray(u)}}class ki extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Ai,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="FatStraightArrow",this._coordinates=e}new(i,t,e,s){return new ki(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Ei{static build(i){if(3===i[0].length)for(const t of i)t.pop();let t=i.flat(1/0),e=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray(t)),[s,r]=[e[0],e[1]];k(e[0],e[1],e[2])&&(s=e[1],r=e[0]);let o=[E(s,r)].concat(e.slice(2)),n=function(i,t,e){const s=.18,r=.3,o=.85,n=.15,l=.8;try{let h=M(i),a=h*s,_=i[i.length-1];h=b(_,i[i.length-2]);let p=b(t,e);a>p*l&&(a=p*l);let d=a*r,c=a*n;a=a>h?h:a;let u=a*o,m=D(i[i.length-2],_,0,a,!0),v=D(i[i.length-2],_,0,u,!0),C=D(_,m,y,d,!1),g=D(_,m,y,d,!0);return[D(_,v,y,c,!1),C,_,g,D(_,v,y,c,!0)]}catch(i){console.log(i)}}(o,s,r),[l,h]=[n[0],n[4]],a=function(i,t,e,s){let r=W(i),o=M(i)*s,n=b(t,e),l=(o-n)/2,[h,a,_]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;h+=b(i[t-1],i[t]);let s=(o/2-h/r*l)/Math.sin(e),n=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);a.push(n),_.push(p)}return a.concat(_)}(o,l,h,b(s,r)/M(o)),_=a.length,p=[s].concat(a.slice(0,_/2));p.push(l);let d=[r].concat(a.slice(_/2,_));d.push(h),p=F(p),d=F(d);let c=q(p.concat(n,d.reverse()));return Cesium.Cartesian3.fromDegreesArray(c)}}class Ti extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Ei,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="AttackArrow",this._coordinates=e}new(i,t,e,s){return new Ti(i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Ii{static build(i){let t=null;if(3===i[0].length)for(const t of i)t.pop();let e=i.flat(1/0),s=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray(e)),[r,o]=[s[0],s[1]];k(s[0],s[1],s[2])&&(r=s[1],o=s[0]);let n=[E(r,o)].concat(s.slice(2)),l=function(i,t,e){const s=.18,r=.3,o=.85,n=.15,l=.8;try{let h=M(i),a=h*s,_=i[i.length-1];h=b(_,i[i.length-2]);let p=b(t,e);a>p*l&&(a=p*l);let d=a*r,c=a*n;a=a>h?h:a;let u=a*o,m=D(i[i.length-2],_,0,a,!0),v=D(i[i.length-2],_,0,u,!0),C=D(_,m,y,d,!1),g=D(_,m,y,d,!0);return[D(_,v,y,c,!1),C,_,g,D(_,v,y,c,!0)]}catch(i){console.log(i)}}(n,r,o),[h,a]=[l[0],l[4]],_=b(r,o),p=M(n),d=.1*p*1;t=D(n[1],n[0],0,d,!0);let c=function(i,t,e,s){let r=W(i),o=M(i)*s,n=b(t,e),l=(o-n)/2,[h,a,_]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;h+=b(i[t-1],i[t]);let s=(o/2-h/r*l)/Math.sin(e),n=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);a.push(n),_.push(p)}return a.concat(_)}(n,h,a,_/p),u=c.length,m=[r].concat(c.slice(0,u/2));m.push(h);let v=[o].concat(c.slice(u/2,u));v.push(a),m=F(m),v=F(v);var C=q(m.concat(l,v.reverse(),[t,m[0]]));return Cesium.Cartesian3.fromDegreesArray(C)}}class Fi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Ii,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="AttackArrowTail",this._coordinates=e}new(i,t,e,s){return new Fi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class xi{static build(i){if(3===i[0].length)for(const t of i)t.pop();let t=i.flat(1/0),e=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray(t)),s=function(i){const t=.1;let e=M(i)*t,s=D(i[1],i[0],y,e,!1),r=D(i[1],i[0],y,e,!0);return[s,r]}(e),r=function(i,t,e){const s=.18,r=.3,o=.85,n=.15,l=.8;try{let h=M(i),a=h*s,_=i[i.length-1];h=b(_,i[i.length-2]);let p=b(t,e);a>p*l&&(a=p*l);let d=a*r,c=a*n;a=a>h?h:a;let u=a*o,m=D(i[i.length-2],_,0,a,!0),v=D(i[i.length-2],_,0,u,!0),C=D(_,m,y,d,!1),g=D(_,m,y,d,!0);return[D(_,v,y,c,!1),C,_,g,D(_,v,y,c,!0)]}catch(i){console.log(i)}}(e,s[0],s[1]),o=r[0],n=r[4],l=function(i,t,e,s){let r=W(i),o=M(i)*s,n=b(t,e),l=(o-n)/2,[h,a,_]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;h+=b(i[t-1],i[t]);let s=(o/2-h/r*l)/Math.sin(e),n=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);a.push(n),_.push(p)}return a.concat(_)}(e,o,n,.1),h=l.length,a=[s[0]].concat(l.slice(0,h/2));a.push(o);let _=[s[1]].concat(l.slice(h/2,h));_.push(n),a=F(a),_=F(_);var p=q(a.concat(r,_.reverse()));return Cesium.Cartesian3.fromDegreesArray(p)}}class $i extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=xi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="SquadCombatArrow",this._coordinates=e}new(i,t,e,s){return new $i(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Li{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]])),e=function(i){const t=.1,e=1;let s=M(i)*t,r=D(i[1],i[0],y,s,!1),o=D(i[1],i[0],y,s,!0),n=s*e,l=D(i[1],i[0],0,n,!0);return[r,l,o]}(t),s=function(i,t,e){const s=.18,r=.3,o=.85,n=.15,l=.8;try{let h=M(i),a=h*s,_=i[i.length-1];h=b(_,i[i.length-2]);let p=b(t,e);a>p*l&&(a=p*l);let d=a*r,c=a*n;a=a>h?h:a;let u=a*o,m=D(i[i.length-2],_,0,a,!0),v=D(i[i.length-2],_,0,u,!0),C=D(_,m,y,d,!1),g=D(_,m,y,d,!0);return[D(_,v,y,c,!1),C,_,g,D(_,v,y,c,!0)]}catch(i){console.log(i)}}(t,e[0],e[2]),r=s[0],o=s[4],n=function(i,t,e,s){let r=W(i),o=M(i)*s,n=b(t,e),l=(o-n)/2,[h,a,_]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;h+=b(i[t-1],i[t]);let s=(o/2-h/r*l)/Math.sin(e),n=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);a.push(n),_.push(p)}return a.concat(_)}(t,r,o,.1),l=n.length,h=[e[0]].concat(n.slice(0,l/2));h.push(r);let a=[e[2]].concat(n.slice(l/2,l));a.push(o),h=F(h),a=F(a);var _=q(h.concat(s,a.reverse(),[e[1],h[0]]));return Cesium.Cartesian3.fromDegreesArray(_)}}class Gi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Li,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="SquadCombatArrowTail",this._coordinates=e}new(i,t,e,s){return new Gi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Hi{static build(i){let t=null,e=null,s=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1],i[3][0],i[3][1]]));{let[i,o,n]=[s[0],s[1],s[2]];e=s[3],t=E(i,o);let[l,h]=[void 0,void 0];k(i,o,n)?(l=Oi(i,t,e,!1),h=Oi(t,o,n,!0)):(l=Oi(o,t,n,!1),h=Oi(t,i,e,!0));let a=l.length,_=(a-5)/2,p=l.slice(0,_),d=l.slice(_,_+5),c=l.slice(_+5,a),u=h.slice(0,_),m=h.slice(_,_+5),v=h.slice(_+5,a);u=L(u);let C=L(v.concat(p.slice(1)));c=L(c);var r=q(u.concat(m,C,d,c));return Cesium.Cartesian3.fromDegreesArray(r)}}}function Oi(i,t,e,s){let r=E(i,t),o=b(r,e),n=D(e,r,0,.3*o,!0),l=D(e,r,0,.5*o,!0);n=D(r,n,y,o/5,s),l=D(r,l,y,o/4,s);let h=[r,n,l,e],a=function(i){try{let t=.25*M(i),e=i[i.length-1],s=.3*t,r=.15*t,o=.85*t,n=D(i[i.length-2],e,0,t,!0),l=D(i[i.length-2],e,0,o,!0),h=D(e,n,y,s,!1),a=D(e,n,y,s,!0);return[D(e,l,y,r,!1),h,e,a,D(e,l,y,r,!0)]}catch(i){console.log(i)}}(h);if(!(a&&Array.isArray(a)&&a.length>0))throw new Error("插值出错");{let[e,s]=[a[0],a[4]],r=function(i,t,e,s){let r=W(i),o=M(i)*s,n=b(t,e),l=(o-n)/2,[h,a,_]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;h+=b(i[t-1],i[t]);let s=(o/2-h/r*l)/Math.sin(e),n=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);a.push(n),_.push(p)}return a.concat(_)}(h,e,s,b(i,t)/M(h)/2);if(r){let o=r.length,n=r.slice(0,o/2),l=r.slice(o/2,o);return n.push(e),l.push(s),n=n.reverse(),n.push(t),l=l.reverse(),l.push(i),n.reverse().concat(a,l)}}}class Ri extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Hi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="DoubleArrow",this._coordinates=e}new(i,t,e,s){return new Ri(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Ui{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]]));var e=q(function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],e[1]],[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2]]}return t}(t)),s=function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],e[1]],[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2],[e[0],s[1]],e]}return t}(t),r=q(s);return[Cesium.Cartesian3.fromDegreesArray(e),Cesium.Cartesian3.fromDegreesArray(r)]}}class ji extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Ui,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=o[0],l=o[1];n.push(n[0]);let h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let a=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,n,h,this._style.opacity,r)),_=Cesium.Color.fromCssColorString(this._style.outlineColor),p=this._style.outlineWidth;this._style.outline||(p=0);let d=this._viewer.scene.primitives.add(Z(`border:${this._id}`,l,_,p,!1,!0));this._primitives.push(a),this._primitives.push(d),this._type="RectangleFlag",this._coordinates=e}new(i,t,e,s){return new ji(this._viewer,i,t,e,s)}move(i){for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let t=this._builder.build(this._coordinates),e=t[0],s=t[1];e.push(e[0]);let r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let o=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,e,r,this._style.opacity,0)),n=Cesium.Color.fromCssColorString(this._style.outlineColor),l=this._style.outlineWidth;this._style.outline||(l=0);let h=this._viewer.scene.primitives.add(Z(`border:${this._id}`,s,n,l,!1,!0));return this._primitives.push(o),this._primitives.push(h),s}update(i,t){2===this._coordinates[i].length?this._coordinates[i]=z(t):3===this._coordinates[i].length&&(this._coordinates[i]=B(t));for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let e=this._builder.build(this._coordinates),s=e[0],r=e[1];s.push(s[0]);let o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let n=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,s,o,this._style.opacity,0)),l=Cesium.Color.fromCssColorString(this._style.outlineColor),h=this._style.outlineWidth;this._style.outline||(h=0);let a=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,l,h,!1,!0));return this._primitives.push(n),this._primitives.push(a),r}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e[1],t,5,!1,!0)}}class zi{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]]));var e=q(function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2]]}return t}(t)),s=function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2],[e[0],s[1]],e]}return t}(t),r=q(s);return[Cesium.Cartesian3.fromDegreesArray(e),Cesium.Cartesian3.fromDegreesArray(r)]}}class Bi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=zi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=o[0],l=o[1];n.push(n[0]);let h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let a=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,n,h,this._style.opacity,r)),_=Cesium.Color.fromCssColorString(this._style.outlineColor),p=this._style.outlineWidth;this._style.outline||(p=0);let d=this._viewer.scene.primitives.add(Z(`border:${this._id}`,l,_,p,!1,!0));this._primitives.push(a),this._primitives.push(d),this._type="TriangleFlag",this._coordinates=e}new(i,t,e,s){return new Bi(this._viewer,i,t,e,s)}move(i){for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let t=this._builder.build(this._coordinates),e=t[0],s=t[1];e.push(e[0]);let r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let o=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,e,r,this._style.opacity,0)),n=Cesium.Color.fromCssColorString(this._style.outlineColor),l=this._style.outlineWidth;this._style.outline||(l=0);let h=this._viewer.scene.primitives.add(Z(`border:${this._id}`,s,n,l,!1,!0));return this._primitives.push(o),this._primitives.push(h),s}update(i,t){2===this._coordinates[i].length?this._coordinates[i]=z(t):3===this._coordinates[i].length&&(this._coordinates[i]=B(t));for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let e=this._builder.build(this._coordinates),s=e[0],r=e[1];s.push(s[0]);let o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let n=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,s,o,this._style.opacity,0)),l=Cesium.Color.fromCssColorString(this._style.outlineColor),h=this._style.outlineWidth;this._style.outline||(h=0);let a=window.viewer.scene.primitives.add(Z(`border:${this._id}`,r,l,h,!1,!0));return this._primitives.push(n),this._primitives.push(a),r}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e[1],t,5,!1,!0)}}class qi{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1]]));var e=q(function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1],r=e,o=[(s[0]-e[0])/4+e[0],(s[1]-e[1])/8+e[1]],n=[(e[0]+s[0])/2,e[1]],l=[3*(s[0]-e[0])/4+e[0],-(s[1]-e[1])/8+e[1]],h=[s[0],e[1]],a=[s[0],(e[1]+s[1])/2],_=[3*(s[0]-e[0])/4+e[0],3*(s[1]-e[1])/8+e[1]],p=[(e[0]+s[0])/2,(e[1]+s[1])/2],d=[(s[0]-e[0])/4+e[0],5*(s[1]-e[1])/8+e[1]],c=[e[0],(e[1]+s[1])/2],u=L([r,o,n,l,h]),m=L([a,_,p,d,c]);t=u.concat(m)}return t}(t)),s=function(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1],r=e,o=[(s[0]-e[0])/4+e[0],(s[1]-e[1])/8+e[1]],n=[(e[0]+s[0])/2,e[1]],l=[3*(s[0]-e[0])/4+e[0],-(s[1]-e[1])/8+e[1]],h=[s[0],e[1]],a=[s[0],(e[1]+s[1])/2],_=[3*(s[0]-e[0])/4+e[0],3*(s[1]-e[1])/8+e[1]],p=[(e[0]+s[0])/2,(e[1]+s[1])/2],d=[(s[0]-e[0])/4+e[0],5*(s[1]-e[1])/8+e[1]],c=[e[0],(e[1]+s[1])/2],u=[e[0],s[1]],m=L([r,o,n,l,h]),v=L([a,_,p,d,c]);t=m.concat(v),t.push(u),t.push(e)}return t}(t),r=q(s);return[Cesium.Cartesian3.fromDegreesArray(e),Cesium.Cartesian3.fromDegreesArray(r)]}}class Ni extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=qi,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=o[0],l=o[1];n.push(n[0]);let h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(h=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let a=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,n,h,this._style.opacity,r)),_=Cesium.Color.fromCssColorString(this._style.outlineColor),p=this._style.outlineWidth;this._style.outline||(p=0);let d=this._viewer.scene.primitives.add(Z(`border:${this._id}`,l,_,p,!1,!0));this._primitives.push(a),this._primitives.push(d),this._type="CurveFlag",this._coordinates=e}new(i,t,e,s){return new Ni(this._viewer,i,t,e,s)}move(i){for(const[t,e]of this._coordinates.entries()){let s=Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]),r=Cesium.Cartesian3.add(s,i,new Cesium.Cartesian3);this._coordinates[t]=B(r)}for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let t=this._builder.build(this._coordinates),e=t[0],s=t[1];e.push(e[0]);let r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(r=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let o=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,e,r,this._style.opacity,0)),n=Cesium.Color.fromCssColorString(this._style.outlineColor),l=this._style.outlineWidth;this._style.outline||(l=0);let h=this._viewer.scene.primitives.add(Z(`border:${this._id}`,s,n,l,!1,!0));return this._primitives.push(o),this._primitives.push(h),s}update(i,t){2===this._coordinates[i].length?this._coordinates[i]=z(t):3===this._coordinates[i].length&&(this._coordinates[i]=B(t));for(const i of this._primitives)this._viewer.scene.primitives.remove(i);this._primitives=[];let e=this._builder.build(this._coordinates),s=e[0],r=e[1];s.push(s[0]);let o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(o=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let n=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,s,o,this._style.opacity,0)),l=Cesium.Color.fromCssColorString(this._style.outlineColor),h=this._style.outlineWidth;this._style.outline||(h=0);let a=this._viewer.scene.primitives.add(Z(`border:${this._id}`,r,l,h,!1,!0));return this._primitives.push(n),this._primitives.push(a),r}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e[1],t,5,!1,!0)}}class Ki{static build(i){let t=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray([i[0][0],i[0][1],i[1][0],i[1][1],i[2][0],i[2][1]])),e=E(t[0],t[2]);t.push(e,t[0],t[1]);let[s,r,o,n,l]=[[],void 0,void 0,void 0,[]];for(let i=0;i<t.length-2;i++){r=t[i],o=t[i+1],n=t[i+2];let e=R(.4,r,o,n);s=s.concat(e)}let h=s.length;s=[s[h-1]].concat(s.slice(0,h-1));for(let i=0;i<t.length-2;i++){r=t[i],o=t[i+1],l.push(r);for(let t=0;t<=w;t++){let e=j(t/w,r,s[2*i],s[2*i+1],o);l.push(e)}l.push(o)}var a=q(l);return Cesium.Cartesian3.fromDegreesArray(a)}}class Yi extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=Ki,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="GatheringPlace",this._coordinates=e}new(i,t,e,s){return new Yi(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class Xi{constructor(i){this._name=i,this._geometrys=new Map}setMapWnd(i){this._mapWnd=i}load(i){for(const t of i.features)switch(t._type){case"Point":this.add(t._id,new Q(this._mapWnd._viewer,t._id,t._coordinates,t._style));break;case"Line":{let i=new si(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setLineStyle(i,i._style.lineStyle,i._style.lineStyleParams)}break;case"Polyline":{let i=new oi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setLineStyle(i,i._style.lineStyle,i._style.lineStyleParams)}break;case"Polygon":{let i=new pi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Rectangle":{let i=new ci(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Circle":{let i=new mi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Arc":{let i=new Ci(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setLineStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Curve":{let i=new fi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setLineStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Arch":{let i=new yi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"Ellipse":{let i=new bi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"StraightThinArrow":{let i=new Mi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setLineStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"FatPointedArrow":{let i=new Di(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"FatStraightArrow":{let i=new ki(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"AttackArrow":{let i=new Ti(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"AttackArrowTail":{let i=new Fi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"SquadCombatArrow":{let i=new $i(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"SquadCombatArrowTail":{let i=new Gi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"DoubleArrow":{let i=new Ri(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"RectangleFlag":{let i=new ji(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"TriangleFlag":{let i=new Bi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"CurveFlag":{let i=new Ni(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}break;case"GatheringPlace":{let i=new Yi(this._mapWnd._viewer,t._id,t._coordinates,t._style);this.add(t._id,i),this.setFillStyle(i,i._style.fillStyle,i._style.fillStyleParams)}}}update(i,t,e){let s=this.get(i);s&&s.update(t,e)}move(i,t){let e=this.get(i);if(e)return e.move(t)}add(i,t){this._geometrys.set(i,t),this._mapWnd.geometryChanged({layer:this._name,state:"add",id:i,type:t._type,show:!0,rename:!1,name:t._name})}get(i){return this._geometrys.get(i)}size(){return this._geometrys.size}delete(i){if(i){let t=this.get(i);t&&(this._mapWnd.geometryChanged({layer:this._name,state:"delete",id:i,type:t._type,show:!0,rename:!1,name:t._name}),t.dispose(),this._geometrys.delete(i))}}save(){let i={type:"FeatureCollection",features:[]};return this._geometrys.forEach(((t,e)=>{var s=Object.assign({},t);delete s._primitives,delete s._entities,delete s._billboards,delete s._labels,delete s._billboard,delete s._viewer,delete s._builder,i.features.push(s)})),JSON.stringify(i)}close(){this._geometrys.size>0&&(this._geometrys.forEach(((i,t)=>{i.dispose()})),this._geometrys.clear())}geometrySelected(){console.log("geometrySelected")}setLineWidth(p,d){var c=Object.assign({},p._primitives[0].appearance.material.uniforms);this.delete(p._id);var u=Object.assign({},p._style);u.width=Number(d);let m=p.new(p._id,p._coordinates,u);switch(m._name=p._name,this.add(m._id,m),m._style.lineStyle){case"Solid":i(m,c);break;case"Dash":t(m,c);break;case"Glow":s(m,c);break;case"Arrow":e(m,c);break;case"Outline":r(m,c);break;case"Fade":o(m,c);break;case"Image":n(m,c);break;case"Pulse":l(m,c);break;case"Flow":h(m,c);break;case"Twinkle":a(m,c);break;case"Scan":_(m,c)}return m}setLineStyle(p,d,c){switch(p._style.lineStyleParams=c,d){case"Solid":p._style.lineStyle="Solid",i(p,c);break;case"Dash":p._style.lineStyle="Dash",t(p,c);break;case"Glow":p._style.lineStyle="Glow",s(p,c);break;case"Outline":p._style.lineStyle="Outline",r(p,c);break;case"Arrow":p._style.lineStyle="Arrow",e(p,c);break;case"Fade":p._style.lineStyle="Fade",o(p,c);break;case"Image":p._style.lineStyle="Image",n(p,c);break;case"Pulse":p._style.lineStyle="Pulse",l(p,c);break;case"Flow":p._style.lineStyle="Flow",h(p,c);break;case"Twinkle":p._style.lineStyle="Twinkle",a(p,c);break;case"Scan":p._style.lineStyle="Scan",_(p,c)}}setFillStyle(i,t,e){switch(i._style.fillStyleParams=e,t){case"Solid":i._style.fillStyle="Solid",g(i,e);break;case"Fade":i._style.fillStyle="Fade",C(i,e);break;case"Image":i._style.fillStyle="Image",v(i,e);break;case"Grid":i._style.fillStyle="Grid",m(i,e);break;case"Stripe":i._style.fillStyle="Stripe",u(i,e);break;case"Checkerboard":i._style.fillStyle="Checkerboard",c(i,e);break;case"Dot":i._style.fillStyle="Dot",d(i,e);break;case"Water":i._style.fillStyle="Water",p(i,e)}}}class Ji{constructor(){this._plotLayerMap=new Map,this._plotLayerIndex=1}addPlotLayer(){let i=new Xi(`图层${this._plotLayerIndex}`);return this._plotLayerMap.set(i._name,i),this._plotLayerIndex++,i}deletePlotLayer(i){this._plotLayerMap.delete(i)}getPlotLayer(i){return this._plotLayerMap.get(i)}getEditPlotLayer(){return this.getPlotLayer("图层1")}load(i){console.log("load",i),this.getEditPlotLayer().load(i)}save(i){console.log("save",i);let t=this.getEditPlotLayer();console.log("plotLayer",t);let e=t.save();var s,r,o,n,l;return console.log("json",e),s=e,r=i,o="text/json",n=document.createElement("a"),l=new Blob([s],{type:o}),n.href=URL.createObjectURL(l),n.download=r,n.click(),888}}class Vi{constructor(i){this._callback=i,this._position=void 0,this._mapWnd=void 0}mouseMove(i,t){}leftUp(i,t){}leftDown(i,t){return(null===this._position||!Cesium.Cartesian2.equals(i.position,this._position))&&(this._position=i.position.clone(),!0)}leftClick(i){}rightUp(i){}rightDown(i){}rightClick(i){}leftDoubleClick(i){}draw(){}done(i){this._callback&&this._callback(i)}setMapWnd(i){this._mapWnd=i}}class Qi extends Vi{constructor(i){super(i),this._type="Point",this._positions=[],this._points=[],this._coordinates=[],this._fixPointCount=1}leftDown(i){super.leftDown(i);var t=this._mapWnd._viewer.camera.getPickRay(i.position),e=this._mapWnd._viewer.scene.globe.pick(t,this._mapWnd._viewer.scene);e&&(this._positions.push(e),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}mouseMove(i){super.mouseMove(i)}rightDown(i){super.rightDown(i)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){}done(i){super.done(i);let t=B(this._points[0]),e=new Q(this._mapWnd._viewer,null,[t]);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e)}generate(){try{if(1==this.getPointCount()){let t=this.getMercatorPoints(),[e]=[t[0]];var i=q([e]);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i)),this.draw()}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class Zi extends Vi{constructor(i){super(i),this._type="Line",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[],this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED,1),this._mapWnd._viewer.scene.primitives.add(this._primitive),console.log(this._mapWnd._viewer)}done(i){super.done(i);let t=B(this._points[0]),e=B(this._points[1]),s=new si(this._mapWnd._viewer,null,[t,e]);this._mapWnd.getMap().getEditPlotLayer().add(s._id,s),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive)}generate(){try{if(this.getPointCount()<2)return null;{let t=this.getMercatorPoints(),[e,s]=[t[0],t[1]];var i=q([e,s]);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class it extends Vi{constructor(i){super(i),this._type="Polyline",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[]}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions))}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new oi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive)}generate(){try{if(this.getPointCount()<2)return null;this.setCoordinates(this._points)}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class tt extends Vi{constructor(i){super(i),this._type="Polygon",this._primitive=null,this._primitive2=null,this._positions=[],this._points=[],this._coordinates=[]}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions))}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),2===this.getPointCount()?(this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)):this.getPointCount()>2&&(this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED,1,!0),this._mapWnd._viewer.scene.primitives.add(this._primitive2))}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new pi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){try{if(this.getPointCount()<2)return null;this.setCoordinates(this._points)}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class et extends Vi{constructor(i){super(i),this._type="Rectangle",this._primitive=null,this._primitive2=null,this._positions=[],this._points=[],this._coordinates=[],this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.5),.5,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED,1,!0),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=B(this._points[0]),e=B(this._points[1]),s=new ci(this._mapWnd._viewer,null,[t,e]);this._mapWnd.getMap().getEditPlotLayer().add(s._id,s),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let t=this.getMercatorPoints();var i=q(this.calculateFlagSurfacePoints(t));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}calculateFlagSurfacePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],e[1]],[s[0],s[1]],[e[0],s[1]]]}return t}}class st extends Vi{constructor(i){super(i),this._type="Circle",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[],this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.5),.5,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED,1,!0),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=B(this._points[0]),e=B(this._points[1]),s=new mi(this._mapWnd._viewer,null,[t,e],null,0);this._mapWnd.getMap().getEditPlotLayer().add(s._id,s),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let t=this.getMercatorPoints(),e=t[0],s=b(e,t[1]);var i=q(this.generatePoints(e,s));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}generatePoints(i,t){let[e,s,r,o]=[null,null,null,[]];for(let n=0;n<=100;n++)r=2*Math.PI*n/100,e=i[0]+t*Math.cos(r),s=i[1]+t*Math.sin(r),o.push([e,s]);return o}}class rt extends Vi{constructor(i){super(i),this._type="Arc",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._fixPointCount=3}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),(2===this.getPointCount()||this.getPointCount()>2)&&(this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive))}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new Ci(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive)}generate(){let i=this.getPointCount();if(!(i<2))if(2===i)this.setCoordinates(this._points);else{let i=this.getMercatorPoints(),[t,e,s,r,o]=[i[0],i[1],i[2],null,null],n=T(t,e,s),l=b(t,n),h=S(t,n),a=S(e,n);k(t,e,s)?(r=a,o=h):(r=h,o=a);let _=q(O(n,l,r,o));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(_))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class ot extends Vi{constructor(i){super(i),this._type="Curve",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[],this._t=.3}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions))}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new fi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive)}generate(){let i=this.getPointCount();if(i<2)return!1;if(2===i)this.setCoordinates(this._points);else{let i=this.getMercatorPoints(),t=q($(this._t,i));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(t))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class nt extends Vi{constructor(i){super(i),this._type="Arch",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._fixPointCount=3}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new yi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){let i=this.getMercatorPoints(),t=this.getPointCount();if(t<2)return!1;{if(2===t){let t=E(i[0],i[1]),e=b(i[0],t),s=D(i[0],t,y,e);i.push(s)}let[s,r,o,n,l]=[i[0],i[1],i[2],void 0,void 0],h=T(s,r,o),a=b(s,h),_=S(s,h),p=S(r,h);k(s,r,o)?(n=p,l=_):(n=_,l=p),i=O(h,a,n,l),i.push(i[0]);var e=q(i);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(e))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class lt{static build(i){if(3===i[0].length)for(const t of i)t.pop();let t=i.flat(1/0),e=function(i){for(var t=[],e=0;e<i.length;e++){var s=N(i[e]);t.push(s)}return t}(Cesium.Cartesian3.fromDegreesArray(t));e.push(e[0],e[1]);let[s,r]=[[],[]];for(let i=0;i<e.length-2;i++){let t=R(.3,e[i],e[i+1],e[i+2]);s=s.concat(t)}let o=s.length;s=[s[o-1]].concat(s.slice(0,o-1));for(let i=0;i<e.length-2;i++){let t=e[i],o=e[i+1];r.push(t);for(let e=0;e<=w;e++){let n=j(e/w,t,s[2*i],s[2*i+1],o);r.push(n)}r.push(o)}var n=q(r);return Cesium.Cartesian3.fromDegreesArray(n)}}class ht extends hi{constructor(i,t,e,s,r){super(i,e),this._viewer=i,this._builder=lt,this._id=t||K(),this._style=s||Object.assign({},_i);let o=this._builder.build(e),n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(this._style.opacity);this._style.fill||(n=Cesium.Color.fromCssColorString(this._style.color).withAlpha(.01));let l=this._viewer.scene.primitives.add(ni(`fill:${this._id}`,o,n,this._style.opacity,r)),h=Cesium.Color.fromCssColorString(this._style.outlineColor),a=this._style.outlineWidth;this._style.outline||(a=0);let _=this._viewer.scene.primitives.add(Z(`border:${this._id}`,o,h,a,!1,!0));this._primitives.push(l),this._primitives.push(_),this._type="CurvedSurface",this._coordinates=e}new(i,t,e,s){return new ht(this._viewer,i,t,e,s)}highlight(i,t){let e=this._builder.build(this._coordinates);return Z(`${i}:${this._id}`,e,t,5,!1,!0)}}class at extends Vi{constructor(i){super(i),this._type="CurvedSurface",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._t=.3}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new ht(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){let i=this.getPointCount();if(i<2)return!1;if(2===i)this.setCoordinates(this._points);else{let i=this.getMercatorPoints();i.push(i[0],i[1]);let[e,s]=[[],[]];for(let t=0;t<i.length-2;t++){let s=R(this._t,i[t],i[t+1],i[t+2]);e=e.concat(s)}let r=e.length;e=[e[r-1]].concat(e.slice(0,r-1));for(let t=0;t<i.length-2;t++){let r=i[t],o=i[t+1];s.push(r);for(let i=0;i<=w;i++){let n=j(i/w,r,e[2*t],e[2*t+1],o);s.push(n)}s.push(o)}var t=q(s);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(t))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class _t extends Vi{constructor(i){super(i),this._type="Ellipse",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[],this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.5),.5,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED,1,!0),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=B(this._points[0]),e=B(this._points[1]),s=new bi(this._mapWnd._viewer,null,[t,e]);this._mapWnd.getMap().getEditPlotLayer().add(s._id,s),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let t=this.getMercatorPoints(),[e,s]=[t[0],t[1]],r=E(e,s),o=Math.abs((e[0]-s[0])/2),n=Math.abs((e[1]-s[1])/2);var i=q(this.generatePoints(r,o,n));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}generatePoints(i,t,e){let[s,r,o,n]=[null,null,null,[]];for(let l=0;l<=w;l++)o=2*Math.PI*l/w,s=i[0]+t*Math.cos(o),r=i[1]+e*Math.sin(o),n.push([s,r]);return n}}class pt extends Vi{constructor(i){super(i),this._type="StraightThinArrow",this._primitive=null,this._positions=[],this._points=[],this._coordinates=[],this._maxArrowLength=3e6,this._arrowLengthScale=5,this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)}done(i){super.done(i);let t=B(this._points[0]),e=B(this._points[1]),s=new Mi(this._mapWnd._viewer,null,[t,e]);this._mapWnd.getMap().getEditPlotLayer().add(s._id,s),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive)}generate(){try{if(this.getPointCount()<2)return null;{let t=this.getMercatorPoints(),[e,s]=[t[0],t[1]],r=b(e,s)/this._arrowLengthScale;r=r>this._maxArrowLength?this._maxArrowLength:r;var i=q([e,s,D(e,s,Math.PI/6,r,!1),s,D(e,s,Math.PI/6,r,!0)]);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class dt extends Vi{constructor(i){super(i),this._type="FatPointedArrow",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._tailWidthFactor=.1,this._neckWidthFactor=.2,this._headWidthFactor=.25,this._headAngle=Math.PI/8.5,this._neckAngle=Math.PI/13,this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED,1,!0),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));this.add(t),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){try{if(this.getPointCount()<2)return null;{let t=this.getMercatorPoints(),[e,s]=[t[0],t[1]],r=M(t),o=r*this._tailWidthFactor,n=r*this._neckWidthFactor,l=r*this._headWidthFactor,h=D(s,e,y,o,!0),a=D(s,e,y,o,!1),_=D(e,s,this._headAngle,l,!1),p=D(e,s,this._headAngle,l,!0);var i=q([h,D(e,s,this._neckAngle,n,!1),_,s,p,D(e,s,this._neckAngle,n,!0),a]);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}add(i){let t=new Di(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class ct extends dt{constructor(i){super(i),this._type="FatStraightArrow",this._tailWidthFactor=.05,this._neckWidthFactor=.1,this._headWidthFactor=.15,this._headAngle=Math.PI/4,this._neckAngle=.17741*Math.PI}add(i){let t=new ki(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}}class ut extends Vi{constructor(i){super(i),this._type="AttackArrow",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._headHeightFactor=.18,this._headWidthFactor=.3,this._neckHeightFactor=.85,this._neckWidthFactor=.15,this._headTailFactor=.8}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions))}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),2===this.getPointCount()?(this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)):this.getPointCount()>2&&(this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=li(this._mapWnd._viewer,"uuid2",this.getCoordinates()),this._mapWnd._viewer.scene.primitives.add(this._primitive2))}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));this.add(t),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){try{let i=this.getPointCount();if(i<2)return null;if(2===i)this.setCoordinates(this._points);else{let i=this.getMercatorPoints(),[t,e]=[i[0],i[1]];k(i[0],i[1],i[2])&&(t=i[1],e=i[0]);let s=[E(t,e)].concat(i.slice(2)),r=this.getArrowHeadPoints(s,t,e),[o,n]=[r[0],r[4]],l=b(t,e)/M(s),h=this.getArrowBodyPoints(s,o,n,l),a=h.length,_=[t].concat(h.slice(0,a/2));_.push(o);let p=[e].concat(h.slice(a/2,a));p.push(n),_=F(_),p=F(p);let d=q(_.concat(r,p.reverse()));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(d))}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}add(i){let t=new Ti(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}getArrowPoints(i,t,e,s){let r=E(i,t),o=b(r,e),n=D(e,r,0,.3*o,!0),l=D(e,r,0,.5*o,!0);n=D(r,n,y,o/5,s),l=D(r,l,y,o/4,s);let h=[r,n,l,e],a=this.getArrowHeadPoints(h);if(!(a&&Array.isArray(a)&&a.length>0))throw new Error("插值出错");{let[e,s]=[a[0],a[4]],r=b(i,t)/M(h)/2,o=this.getArrowBodyPoints(h,e,s,r);if(o){let r=o.length,n=o.slice(0,r/2),l=o.slice(r/2,r);return n.push(e),l.push(s),n=n.reverse(),n.push(t),l=l.reverse(),l.push(i),n.reverse().concat(a,l)}}}getArrowHeadPoints(i,t,e){try{let s=M(i),r=s*this._headHeightFactor,o=i[i.length-1];s=b(o,i[i.length-2]);let n=b(t,e);r>n*this._headTailFactor&&(r=n*this._headTailFactor);let l=r*this._headWidthFactor,h=r*this._neckWidthFactor;r=r>s?s:r;let a=r*this._neckHeightFactor,_=D(i[i.length-2],o,0,r,!0),p=D(i[i.length-2],o,0,a,!0),d=D(o,_,y,l,!1),c=D(o,_,y,l,!0);return[D(o,p,y,h,!1),d,o,c,D(o,p,y,h,!0)]}catch(i){console.log(i)}}getArrowBodyPoints(i,t,e,s){let r=W(i),o=M(i)*s,n=(o-b(t,e))/2,[l,h,a]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;l+=b(i[t-1],i[t]);let s=(o/2-l/r*n)/Math.sin(e),_=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);h.push(_),a.push(p)}return h.concat(a)}getTempPoint4(i,t,e){try{let s=E(i,t),r=b(s,e),o=A(i,s,e),[n,l,h,a]=[void 0,void 0,void 0,void 0];return o<y?(l=r*Math.sin(o),h=r*Math.cos(o),a=D(i,s,y,l,!1),n=D(s,a,y,h,!0)):o>=y&&o<Math.PI?(l=r*Math.sin(Math.PI-o),h=r*Math.cos(Math.PI-o),a=D(i,s,y,l,!1),n=D(s,a,y,h,!1)):o>=Math.PI&&o<1.5*Math.PI?(l=r*Math.sin(o-Math.PI),h=r*Math.cos(o-Math.PI),a=D(i,s,y,l,!0),n=D(s,a,y,h,!0)):(l=r*Math.sin(2*Math.PI-o),h=r*Math.cos(2*Math.PI-o),a=D(i,s,y,l,!0),n=D(s,a,y,h,!1)),n}catch(i){console.log(i)}}}class mt extends ut{constructor(i){super(i),this._type="AttackArrowTail",this._headHeightFactor=.18,this._headWidthFactor=.3,this._neckHeightFactor=.85,this._neckWidthFactor=.15,this._tailWidthFactor=.1,this._headTailFactor=.8,this._swallowTailFactor=1,this._swallowTailPnt=null}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),2===this.getPointCount()?(this._primitive=Z(this.uuid,this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)):this.getPointCount()>2&&(this._primitive=ni(this.uuid,this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=li(this._mapWnd._viewer,this.uuid2,this.getCoordinates()),this._mapWnd._viewer.scene.primitives.add(this._primitive2))}add(i){let t=new Fi(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}generate(){try{let t=this.getPointCount();if(t<2)return null;if(2===t)return this.setCoordinates(this._points),!1;{let t=this.getMercatorPoints(),[e,s]=[t[0],t[1]];k(t[0],t[1],t[2])&&(e=t[1],s=t[0]);let r=[E(e,s)].concat(t.slice(2)),o=this.getArrowHeadPoints(r,e,s),[n,l]=[o[0],o[4]],h=b(e,s),a=M(r),_=a*this._tailWidthFactor*this._swallowTailFactor;this._swallowTailPnt=D(r[1],r[0],0,_,!0);let p=h/a,d=this.getArrowBodyPoints(r,n,l,p),c=d.length,u=[e].concat(d.slice(0,c/2));u.push(n);let m=[s].concat(d.slice(c/2,c));m.push(l),u=F(u),m=F(m);var i=q(u.concat(o,m.reverse(),[this._swallowTailPnt,u[0]]));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}}class vt extends ut{constructor(i){super(i),this._type="SquadCombatArrow",this._headHeightFactor=.18,this._headWidthFactor=.3,this._neckHeightFactor=.85,this._neckWidthFactor=.15,this._tailWidthFactor=.1}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=li(this._mapWnd._viewer,"uuid2",this.getCoordinates()),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}add(i){let t=new $i(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}generate(){try{if(this.getPointCount()<2)return!1;{let t=this.getMercatorPoints(),e=this.getTailPoints(t),s=this.getArrowHeadPoints(t,e[0],e[1]),r=s[0],o=s[4],n=this.getArrowBodyPoints(t,r,o,this._tailWidthFactor),l=n.length,h=[e[0]].concat(n.slice(0,l/2));h.push(r);let a=[e[1]].concat(n.slice(l/2,l));a.push(o),h=F(h),a=F(a);var i=q(h.concat(s,a.reverse()));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}getTailPoints(i){let t=M(i)*this._tailWidthFactor;return[D(i[1],i[0],y,t,!1),D(i[1],i[0],y,t,!0)]}}class Ct extends ut{constructor(i){super(i),this._type="SquadCombatArrowTail",this._headHeightFactor=.18,this._headWidthFactor=.3,this._neckHeightFactor=.85,this._neckWidthFactor=.15,this._tailWidthFactor=.1,this._swallowTailFactor=1,this._swallowTailPnt=null,this._fixPointCount=2}leftDown(i){super.leftDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=li(this._mapWnd._viewer,"uuid2",this.getCoordinates()),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}add(i){let t=new Gi(this._mapWnd._viewer,null,i);this._mapWnd.getMap().getEditPlotLayer().add(t._id,t)}generate(){try{if(this.getPointCount()<2)return!1;{let t=this.getMercatorPoints(),e=this.getTailPoints(t),s=this.getArrowHeadPoints(t,e[0],e[2]),r=s[0],o=s[4],n=this.getArrowBodyPoints(t,r,o,this._tailWidthFactor),l=n.length,h=[e[0]].concat(n.slice(0,l/2));h.push(r);let a=[e[2]].concat(n.slice(l/2,l));a.push(o),h=F(h),a=F(a);var i=q(h.concat(s,a.reverse(),[e[1],h[0]]));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i))}}catch(i){console.log(i)}}getTailPoints(i){let t=M(i)*this._tailWidthFactor,e=D(i[1],i[0],y,t,!1),s=D(i[1],i[0],y,t,!0),r=t*this._swallowTailFactor;return[e,D(i[1],i[0],0,r,!0),s]}}class gt extends Vi{constructor(i){super(i),this._type="DoubleArrow",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._headHeightFactor=.25,this._headWidthFactor=.3,this._neckHeightFactor=.85,this._neckWidthFactor=.15,this._connPoint=null,this._tempPoint4=null,this._fixPointCount=4}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),2===this.getPointCount()?(this._primitive=Z("uuid",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive)):this.getPointCount()>2&&(this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=li(this._mapWnd._viewer,"uuid2",this.getCoordinates()),this._mapWnd._viewer.scene.primitives.add(this._primitive2))}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new Ri(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){try{var i=this.getMercatorPoints();let e=this.getPointCount();if(e<2)return null;if(2===e)return this.setCoordinates(this._points),!1;if(e>2){let[s,r,o]=[i[0],i[1],i[2]];3===e?(this._tempPoint4=this.getTempPoint4(s,r,o),this._connPoint=E(s,r)):4===e?(this._tempPoint4=i[3],this._connPoint=E(s,r)):(this._tempPoint4=i[3],this._connPoint=i[4]);let[n,l]=[void 0,void 0];k(s,r,o)?(n=this.getArrowPoints(s,this._connPoint,this._tempPoint4,!1),l=this.getArrowPoints(this._connPoint,r,o,!0)):(n=this.getArrowPoints(r,this._connPoint,o,!1),l=this.getArrowPoints(this._connPoint,s,this._tempPoint4,!0));let h=n.length,a=(h-5)/2,_=n.slice(0,a),p=n.slice(a,a+5),d=n.slice(a+5,h),c=l.slice(0,a),u=l.slice(a,a+5),m=l.slice(a+5,h);c=L(c);let v=L(m.concat(_.slice(1)));d=L(d);var t=q(c.concat(u,v,p,d));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(t))}}catch(i){console.log(i)}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}getArrowPoints(i,t,e,s){let r=E(i,t),o=b(r,e),n=D(e,r,0,.3*o,!0),l=D(e,r,0,.5*o,!0);n=D(r,n,y,o/5,s),l=D(r,l,y,o/4,s);let h=[r,n,l,e],a=this.getArrowHeadPoints(h);if(!(a&&Array.isArray(a)&&a.length>0))throw new Error("插值出错");{let[e,s]=[a[0],a[4]],r=b(i,t)/M(h)/2,o=this.getArrowBodyPoints(h,e,s,r);if(o){let r=o.length,n=o.slice(0,r/2),l=o.slice(r/2,r);return n.push(e),l.push(s),n=n.reverse(),n.push(t),l=l.reverse(),l.push(i),n.reverse().concat(a,l)}}}getArrowHeadPoints(i){try{let t=M(i)*this._headHeightFactor,e=i[i.length-1],s=t*this._headWidthFactor,r=t*this._neckWidthFactor,o=t*this._neckHeightFactor,n=D(i[i.length-2],e,0,t,!0),l=D(i[i.length-2],e,0,o,!0),h=D(e,n,y,s,!1),a=D(e,n,y,s,!0);return[D(e,l,y,r,!1),h,e,a,D(e,l,y,r,!0)]}catch(i){console.log(i)}}getArrowBodyPoints(i,t,e,s){let r=W(i),o=M(i)*s,n=(o-b(t,e))/2,[l,h,a]=[0,[],[]];for(let t=1;t<i.length-1;t++){let e=A(i[t-1],i[t],i[t+1])/2;l+=b(i[t-1],i[t]);let s=(o/2-l/r*n)/Math.sin(e),_=D(i[t-1],i[t],Math.PI-e,s,!0),p=D(i[t-1],i[t],e,s,!1);h.push(_),a.push(p)}return h.concat(a)}getTempPoint4(i,t,e){try{let s=E(i,t),r=b(s,e),o=A(i,s,e),[n,l,h,a]=[void 0,void 0,void 0,void 0];return o<y?(l=r*Math.sin(o),h=r*Math.cos(o),a=D(i,s,y,l,!1),n=D(s,a,y,h,!0)):o>=y&&o<Math.PI?(l=r*Math.sin(Math.PI-o),h=r*Math.cos(Math.PI-o),a=D(i,s,y,l,!1),n=D(s,a,y,h,!1)):o>=Math.PI&&o<1.5*Math.PI?(l=r*Math.sin(o-Math.PI),h=r*Math.cos(o-Math.PI),a=D(i,s,y,l,!0),n=D(s,a,y,h,!0)):(l=r*Math.sin(2*Math.PI-o),h=r*Math.cos(2*Math.PI-o),a=D(i,s,y,l,!0),n=D(s,a,y,h,!1)),n}catch(i){console.log(i)}}}class ft extends Vi{constructor(i){super(i),this._type="RectangleFlag",this._positions=[],this._points=[],this._coordinates=[],this._coordinates2=[],this._primitive=null,this._primitive2=null,this._maxArrowLength=3e6,this._arrowLengthScale=5,this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni(this.uuid,this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z(this.uuid2,this.getCoordinates2(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new ji(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let e=this.getMercatorPoints();var i=q(this.calculateFlagSurfacePoints(e));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i));var t=q(this.calculateFlagpolePoints(e));this.setCoordinates2(Cesium.Cartesian3.fromDegreesArray(t))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}getCoordinates2(){return this._coordinates2}setCoordinates(i){this._coordinates=i}setCoordinates2(i){this._coordinates2=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}calculateFlagSurfacePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],e[1]],[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2]]}return t}calculateFlagpolePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],e[1]],[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2],[e[0],s[1]],e]}return t}}class wt extends Vi{constructor(i){super(i),this._type="TriangleFlag",this._positions=[],this._points=[],this._coordinates=[],this._coordinates2=[],this._primitive=null,this._primitive2=null,this._maxArrowLength=3e6,this._arrowLengthScale=5,this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni(this.uuid,this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z(this.uuid2,this.getCoordinates2(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new Bi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let e=this.getMercatorPoints();var i=q(this.calculateFlagSurfacePoints(e));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i));var t=q(this.calculateFlagpolePoints(e));this.setCoordinates2(Cesium.Cartesian3.fromDegreesArray(t))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}getCoordinates2(){return this.coordinates2}setCoordinates(i){this._coordinates=i}setCoordinates2(i){this.coordinates2=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}calculateFlagSurfacePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2]]}return t}calculateFlagpolePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1];t=[e,[s[0],(e[1]+s[1])/2],[e[0],(e[1]+s[1])/2],[e[0],s[1]],e]}return t}}class yt extends Vi{constructor(i){super(i),this._type="CurveFlag",this._positions=[],this._points=[],this._coordinates=[],this._coordinates2=[],this._primitive=null,this._primitive2=null,this._maxArrowLength=3e6,this._arrowLengthScale=5,this._fixPointCount=2}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni(this.uuid,this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z(this.uuid2,this.getCoordinates2(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new Ni(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){if(this.getPointCount()<2)return!1;{let e=this.getMercatorPoints();var i=q(this.calculateFlagSurfacePoints(e));this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(i));var t=q(this.calculateFlagpolePoints(e));this.setCoordinates2(Cesium.Cartesian3.fromDegreesArray(t))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}getCoordinates2(){return this.coordinates2}setCoordinates(i){this._coordinates=i}setCoordinates2(i){this.coordinates2=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}calculateFlagSurfacePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1],r=e,o=[(s[0]-e[0])/4+e[0],(s[1]-e[1])/8+e[1]],n=[(e[0]+s[0])/2,e[1]],l=[3*(s[0]-e[0])/4+e[0],-(s[1]-e[1])/8+e[1]],h=[s[0],e[1]],a=[s[0],(e[1]+s[1])/2],_=[3*(s[0]-e[0])/4+e[0],3*(s[1]-e[1])/8+e[1]],p=[(e[0]+s[0])/2,(e[1]+s[1])/2],d=[(s[0]-e[0])/4+e[0],5*(s[1]-e[1])/8+e[1]],c=[e[0],(e[1]+s[1])/2],u=L([r,o,n,l,h]),m=L([a,_,p,d,c]);t=u.concat(m)}return t}calculateFlagpolePoints(i){let t=[];if(i.length>1){let e=i[0],s=i[i.length-1],r=e,o=[(s[0]-e[0])/4+e[0],(s[1]-e[1])/8+e[1]],n=[(e[0]+s[0])/2,e[1]],l=[3*(s[0]-e[0])/4+e[0],-(s[1]-e[1])/8+e[1]],h=[s[0],e[1]],a=[s[0],(e[1]+s[1])/2],_=[3*(s[0]-e[0])/4+e[0],3*(s[1]-e[1])/8+e[1]],p=[(e[0]+s[0])/2,(e[1]+s[1])/2],d=[(s[0]-e[0])/4+e[0],5*(s[1]-e[1])/8+e[1]],c=[e[0],(e[1]+s[1])/2],u=[e[0],s[1]],m=L([r,o,n,l,h]),v=L([a,_,p,d,c]);t=m.concat(v),t.push(u),t.push(e)}return t}}class Pt extends Vi{constructor(i){super(i),this._type="GatheringPlace",this._positions=[],this._points=[],this._coordinates=[],this._primitive=null,this._primitive2=null,this._t=.4,this._fixPointCount=3}leftDown(i){if(super.leftDown(i)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84);t&&(this._positions.push(t),this.setPoints(this._positions)),this.getPointCount()===this._fixPointCount&&this.done(this._type)}}mouseMove(i){if(super.mouseMove(i),!(this.getPointCount()<1)){var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);if(t){var e=this._positions.concat([t]);this.setPoints(e),this.draw()}}}rightDown(i){super.rightDown(i),this.getPointCount()===this._fixPointCount&&this.done(this._type)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i)}draw(){Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2),this._primitive=ni("uuid",this.getCoordinates(),Cesium.Color.RED.withAlpha(.2),.2,0),this._mapWnd._viewer.scene.primitives.add(this._primitive),this._primitive2=Z("uuid2",this.getCoordinates(),Cesium.Color.RED),this._mapWnd._viewer.scene.primitives.add(this._primitive2)}done(i){super.done(i);let t=[];for(const i of this._points)t.push(B(i));let e=new Yi(this._mapWnd._viewer,null,t);this._mapWnd.getMap().getEditPlotLayer().add(e._id,e),Cesium.defined(this._primitive)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive),Cesium.defined(this._primitive2)&&this._mapWnd._viewer.scene.primitives.remove(this._primitive2)}generate(){let i=this.getMercatorPoints(),t=this.getPointCount();if(t<2)return!1;{if(2===t){let t=E(i[0],i[1]),e=b(i[0],t)/.9,s=D(i[0],t,y,e,!0);i=[i[0],s,i[1]]}let s=E(i[0],i[2]);i.push(s,i[0],i[1]);let[r,o,n,l,h]=[[],void 0,void 0,void 0,[]];for(let t=0;t<i.length-2;t++){o=i[t],n=i[t+1],l=i[t+2];let e=R(this._t,o,n,l);r=r.concat(e)}let a=r.length;r=[r[a-1]].concat(r.slice(0,a-1));for(let t=0;t<i.length-2;t++){o=i[t],n=i[t+1],h.push(o);for(let i=0;i<=w;i++){let e=j(i/w,o,r[2*t],r[2*t+1],n);h.push(e)}h.push(n)}var e=q(h);this.setCoordinates(Cesium.Cartesian3.fromDegreesArray(e))}}getPointCount(){return this._points.length}setPoints(i){this._points=i||[],this._points.length>=1&&this.generate()}getCoordinates(){return this._coordinates}setCoordinates(i){this._coordinates=i}getMercatorPoints(){for(var i=[],t=0;t<this._points.length;t++){var e=N(this._points[t]);i.push(e)}return i}}class bt{constructor(){return bt.instance||(bt.instance=this,this._id=null,this._highlightPrimitive=null),bt.instance}static getInstance(){return this.instance?this.instance:this.instance=new bt}setMapWnd(i){this._mapWnd=i}hitTest(i){var t=this._mapWnd._viewer.scene.pick(i);return t&&"string"==typeof t.id?(null===this._id||this._id&&(this._id,t.id),!0):!(!t||"object"!=typeof t.id)&&void this._mapWnd.getMap().getEditPlotLayer().get(this._id)}setHighlight(i){this.clearHighlight();let t=this._mapWnd.getMap().getEditPlotLayer();if(i.primitive instanceof Cesium.Billboard){let e=t.get(i.id.split(":")[1]);this._highlightBillborad=e.highlight("highlight",Cesium.Color.WHITE)}else if(i.primitive instanceof Cesium.Label){let e=t.get(i.id.split(":")[1]);this._highlightLabel=e.highlight("highlight",Cesium.Color.GOLD)}else{let e=t.get(i.id.split(":")[1]);this._highlightPrimitive=e.highlight("highlight",Cesium.Color.WHITE),viewer.scene.primitives.add(this._highlightPrimitive)}}clearHighlight(){viewer.scene.primitives.remove(this._highlightPrimitive),J.getInstance()._points.remove(this._highlightBillborad)}}class Wt{constructor(){this._id=void 0,this._handles=[]}setId(i){this.clearHandles(),this._id=i.split(":")[1],this.getHandles()}setMapWnd(i){this._mapWnd=i}getHandles(){let i=this._mapWnd.getMap().getEditPlotLayer().get(this._id);for(const[e,s]of i._coordinates.entries()){var t=this._mapWnd._viewer.entities.add({id:e,parentId:this._id,position:Cesium.Cartesian3.fromDegrees(s[0],s[1],s[2]),point:{color:Cesium.Color.WHITE.withAlpha(.3),pixelSize:15}});this._handles.push(t)}}clearHandles(){for(const i of this._handles)this._mapWnd._viewer.entities.remove(i)}refresh(){this.clearHandles(),this.getHandles()}}class Mt{constructor(){return Mt.instance||(Mt.instance=this,this._id=null,this._highlightPrimitive=null,this._hc=new Wt),Mt.instance}static getInstance(){return this.instance?this.instance:this.instance=new Mt}setMapWnd(i){this._mapWnd=i,this._hc.setMapWnd(i)}del(){if(null===this._id)return;let i=this._mapWnd.getMap().getEditPlotLayer(),t=this._id.split(":");if(2===t.length){let e=t[1];i.delete(e),this.clearHighlight(),this._hc.clearHandles()}}getHandlePoint(i){var t=viewer.scene.pick(i);return t&&"object"==typeof t.id?t.id:null}hitTest(i){var t=viewer.scene.pick(i);return t&&"string"==typeof t.id?(bt.getInstance().clearHighlight(),(null===this._id||this._id&&this._id!==t.id)&&(this._id=t.id,this.setHighlight(t),this._hc.setId(t.id)),!0):t&&"object"==typeof t.id?(bt.getInstance().clearHighlight(),this._id=t.id.id,void this._mapWnd.getMap().getEditPlotLayer().get(this._id)):(this.clearHighlight(),this._id=null,this._hc.clearHandles(),!1)}setHighlight(i){this.clearHighlight(),i.primitive instanceof Cesium.Billboard||(i.primitive,Cesium.Label)}setHighlightById(i){this.clearHighlight(),this._mapWnd.getMap().getEditPlotLayer(),this._id="highlight:"+i,this._hc.setId("highlight:"+i)}clearHighlight(){viewer.scene.primitives.remove(this._highlightPrimitive)}refresh(i){viewer.scene.primitives.remove(this._highlightPrimitive),this._highlightPrimitive=Z("selection-highlight",i,Cesium.Color.YELLOW.withAlpha(.5),5,!1,!1),viewer.scene.primitives.add(this._highlightPrimitive)}}class St extends Vi{constructor(i,t){super(i),this._type="Handle",this._hp=t}leftDown(i){super.leftDown(i),this._mapWnd._viewer.scene.screenSpaceCameraController.enableRotate=!1,this._mapWnd._viewer.scene.screenSpaceCameraController.enableTranslate=!1}mouseMove(i){super.mouseMove(i);var t=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.endPosition,Cesium.Ellipsoid.WGS84);this._hp.position=t,this._mapWnd.getMap().getEditPlotLayer().update(this._hp.parentId,this._hp.id,t)}rightDown(i){super.rightDown(i)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i),this._mapWnd._viewer.scene.screenSpaceCameraController.enableRotate=!0,this._mapWnd._viewer.scene.screenSpaceCameraController.enableTranslate=!0}}class Dt extends Vi{constructor(i,t){super(i),this._type="Move",this._id=t,this._oldPosition=null}leftDown(i){super.leftDown(i),this._oldPosition=this._mapWnd._viewer.scene.camera.pickEllipsoid(i.position,Cesium.Ellipsoid.WGS84),this._mapWnd._viewer.scene.screenSpaceCameraController.enableRotate=!1,this._mapWnd._viewer.scene.screenSpaceCameraController.enableTranslate=!1}mouseMove(i){super.mouseMove(i);var t=this._mapWnd._viewer.camera.getPickRay(i.endPosition),e=this._mapWnd._viewer.scene.globe.pick(t,this._mapWnd._viewer.scene);let s=Cesium.Cartesian3.subtract(e,this._oldPosition,new Cesium.Cartesian3);this._mapWnd.getMap().getEditPlotLayer().move(this._id,s),Mt.getInstance().clearHighlight(),this._oldPosition=e}rightDown(i){super.rightDown(i)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i),this._mapWnd._viewer.scene.screenSpaceCameraController.enableRotate=!0,this._mapWnd._viewer.scene.screenSpaceCameraController.enableTranslate=!0}}class At extends Vi{constructor(i){super(i),this._type="SelectPoint",this._childTool=null}leftDown(i){super.leftDown(i);let t=Mt.getInstance();bt.getInstance().clearHighlight();let e=t.getHandlePoint(i.position);if(e&&e instanceof Cesium.Entity){if(null!=this._mapWnd.getMap().getEditPlotLayer().get(e.parentId))return t.clearHighlight(),this._childTool=new St(null,e),this._childTool.setMapWnd(this._mapWnd),void this._childTool.leftDown(i);t._hc._id=void 0}if(t.hitTest(i.position)){if(t._hc._id){this._childTool=new Dt(null,t._hc._id),this._childTool.setMapWnd(this._mapWnd),this._childTool.leftDown(i);let e=this._mapWnd.getMap().getEditPlotLayer().get(t._hc._id);this._mapWnd.geometrySelected(e)}}else this._mapWnd.geometrySelected(null),t._hc._id=void 0,t._hc.clearHandles()}mouseMove(i){if(super.mouseMove(i),this._childTool)return this._childTool.mouseMove(i),void("Move"===this._childTool._type&&Mt.getInstance()._hc.refresh());bt.getInstance().hitTest(i.endPosition)?this._mapWnd.setCursor("move"):this._mapWnd.setCursor("auto")}rightDown(i){super.rightDown(i)}leftDoubleClick(i){super.leftDoubleClick(i)}leftUp(i){super.leftUp(i),this._childTool&&(this._childTool.leftUp(i),this._childTool._type,this._childTool=null)}}window.LhMapWnd=class{constructor(i){this._viewer=i,this._geometrySelectChangedCallback=void 0,this._map=new Ji,this._usingTool="SelectPoint",this._tool=void 0,this.init()}setCursor(i){document.getElementById(this._viewer._container.id).style.cursor=i}init(){var i=this,t=new Cesium.ScreenSpaceEventHandler(i._viewer.scene.canvas);t.setInputAction((function(i){}),Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction((function(t){let e=i._viewer.scene.pickPosition(t.position);i._tool.leftDown(t,e)}),Cesium.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction((function(t){let e=i._viewer.scene.pickPosition(t.position);i._tool.leftUp(t,e)}),Cesium.ScreenSpaceEventType.LEFT_UP),t.setInputAction((t=>{let e=i._viewer.scene.pickPosition(t.endPosition);i._tool.mouseMove(t,e)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction((function(t){i._tool.rightDown(t)}),Cesium.ScreenSpaceEventType.RIGHT_CLICK),this._viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.setInputAction((function(t){console.log("双击了"),i._viewer.trackedEntity=void 0,i._tool.leftDoubleClick(t)}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.setTool("SelectPoint"),bt.getInstance().setMapWnd(this),Mt.getInstance().setMapWnd(this)}setTool(i,t){switch(this._usingTool=i,i){case"SelectPoint":this._tool=new At(null),this._tool.setMapWnd(this);break;case"Point":this._tool=new Qi((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Line":this._tool=new Zi((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Polyline":this._tool=new it((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Rectangle":this._tool=new et((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Polygon":this._tool=new tt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Circle":this._tool=new st((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Arc":this._tool=new rt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Curve":this._tool=new ot((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Arch":this._tool=new nt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"CurvedSurface":this._tool=new at((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"Ellipse":this._tool=new _t((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"StraightThinArrow":this._tool=new pt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"FatPointedArrow":this._tool=new dt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"FatStraightArrow":this._tool=new ct((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"AttackArrow":this._tool=new ut((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"AttackArrowTail":this._tool=new mt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"SquadCombatArrow":this._tool=new vt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"SquadCombatArrowTail":this._tool=new Ct((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"DoubleArrow":this._tool=new gt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"RectangleFlag":this._tool=new ft((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"TriangleFlag":this._tool=new wt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"CurveFlag":this._tool=new yt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this);break;case"GatheringPlace":this._tool=new Pt((()=>{this.setTool("SelectPoint")})),this._tool.setMapWnd(this)}}usingTool(){return this._usingTool}geometrySelected(i){this._geometrySelectChangedCallback&&this._geometrySelectChangedCallback(i)}setGeometryChangeCallback(i){this._geometrySelectChangedCallback=i}geometryChanged(i){this._changeCallback&&this._changeCallback(i)}getMap(){return this._map}},class{constructor(){}static start(){document.onkeydown=function(i){const t=i||event||window.event,e=i.metaKey;t&&46===t.keyCode&&Mt.getInstance().del(),e&&t&&8===t.keyCode&&Mt.getInstance().del()},document.oncontextmenu=function(i){return!1}}}.start()}));
